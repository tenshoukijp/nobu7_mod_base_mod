/*
00477E40  |. 895424 30      |MOV DWORD PTR SS:[ESP+30],EDX
00477E44  |. 8B40 04        |MOV EAX,DWORD PTR DS:[EAX+4]
00477E47  |. 83EC 08        |SUB ESP,8
00477E4A  |. 8D5424 38      |LEA EDX,DWORD PTR SS:[ESP+38]
00477E4E  |. 8BCC           |MOV ECX,ESP
00477E50  |. 52             |PUSH EDX                                ; /Arg1
00477E51  |. 894424 40      |MOV DWORD PTR SS:[ESP+40],EAX           ; |
00477E55  |. E8 DAAB0800    |CALL Nobunaga.00502A34                  ; \Nobunaga.00502A34
00477E5A  |. 8D85 F0030000  |LEA EAX,DWORD PTR SS:[EBP+3F0]
00477E60  |. 50             |PUSH EAX
00477E61  |. B9 380F5800    |MOV ECX,Nobunaga.00580F38
00477E66  |. E8 B5D7FEFF    |CALL Nobunaga.00465620
00477E6B  |. 8B4C24 28      |MOV ECX,DWORD PTR SS:[ESP+28]
00477E6F  |. 8B4424 24      |MOV EAX,DWORD PTR SS:[ESP+24]
00477E73  |. 83C0 10        |ADD EAX,10
00477E76  |. 890D 8CC86000  |MOV DWORD PTR DS:[60C88C],ECX
00477E7C  |. 8B4C24 10      |MOV ECX,DWORD PTR SS:[ESP+10]
00477E80  |. A3 E0ED5300    |MOV DWORD PTR DS:[53EDE0],EAX
00477E85  |. A3 88C86000    |MOV DWORD PTR DS:[60C888],EAX
00477E8A  |. E8 A12F0000    |CALL Nobunaga.0047AE30
00477E8F  |. 50             |PUSH EAX
00477E90  |. 68 DC3D5200    |PUSH Nobunaga.00523DDC                  ;  ASCII ":%4d:"
00477E95  |. 68 A8C86000    |PUSH Nobunaga.0060C8A8                  ;  ASCII "†ôR"

*/

/*
Ç±ÇÃï”Ç™ñÏêÌéûÇÃïîë‡ÇÃèÓïÒÇÃÇÊÇ§Çæ
00584C7C  10 00 00 00 3C 0A 52 00 00 00 00 00 00 00 00 00  ...<.R.........
00584C8C  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
00584C9C  00 00 00 00 00 00 00 00 02 00 00 00 12 00 00 00  ..............
00584CAC  FF FF FF FF 10 00 00 00 3C 0A 52 00 00 00 00 00  ˇˇˇˇ...<.R.....
00584CBC  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
00584CCC  00 00 00 00 00 00 00 00 00 00 00 00 02 00 00 00  ...............
00584CDC  12 00 00 00 FF FF FF FF 10 00 00 00 3C 0A 52 00  ...ˇˇˇˇ...<.R.
00584CEC  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
00584CFC  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
00584D0C  02 00 00 00 12 00 00 00 FF FF FF FF 10 00 00 00  ......ˇˇˇˇ...
00584D1C  3C 0A 52 00 00 00 00 00 00 00 00 00 00 00 00 00  <.R.............
00584D2C  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
00584D3C  00 00 00 00 02 00 00 00 12 00 00 00 FF FF FF FF  ..........ˇˇˇˇ
00584D4C  10 00 00 00 98 00 00 00 80 00 00 00 0A 00 00 00  ...ÅE..Ä.......
00584D5C  18 00 00 00 D8 00 00 00 18 00 00 00 60 00 00 00  ...ÿ......`...
00584D6C  08 01 00 00 D8 00 00 00 08 01 00 00 60 00 00 00  ..ÿ.....`...
00584D7C  01 00 00 00 08 00 00 00 20 00 00 00 08 00 00 00  ...... ......
00584D8C  60 01 00 00 F0 01 00 00 20 00 00 00 F0 01 00 00  `..ÅE.. ...ÅE..
00584D9C  60 01 00 00 01 00 00 00 08 00 00 00 80 01 00 00  `........Ä..
00584DAC  08 00 00 00 58 00 00 00 58 02 00 00 80 01 00 00  ...X...X..Ä..
00584DBC  58 02 00 00 58 00 00 00 01 00 00 00 18 00 00 00  X..X.........
00584DCC  60 00 00 00 20 00 00 00 00 00 00 00 60 00 00 00  `... .......`...
00584DDC  00 00 00 00 60 00 00 00 E0 FF FF FF 20 00 00 00  ....`...ÅEˇˇ ...
00584DEC  E0 FF FF FF 08 01 00 00 60 00 00 00 08 00 00 00  ÅEˇˇ..`......
00584DFC  80 01 00 00 28 00 00 00 78 00 00 00 08 00 00 00  Ä..(...x......
00584E0C  60 01 00 00 08 00 00 00 58 00 00 00 0C 3D 52 00  `.....X....=R.
00584E1C  2D F0 00 00 00 00 00 00 00 00 00 00 00 00 00 00  -ÅE.............
00584E2C  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
00584E3C  00 20 00 00 00 00 00 00 00 00 00 00 04 00 00 00  . .............
00584E4C  04 00 00 00 F8 FF FF FF F8 FF FF FF 00 00 00 00  ...ÅEˇˇÅEˇˇ....
00584E5C  00 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00  ...............
00584E6C  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
00584E7C  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
00584E8C  4F 10 52 00 B9 00 00 00 10 00 00 00 00 00 00 00  OR.π..........
00584E9C  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
00584EAC  F0 01 00 00 60 01 00 00 14 00 00 00 64 00 00 00  ÅE..`.....d...
00584EBC  00 00 00 00 00 00 00 00 00 00 00 00 FF FF FF 7F  ............ˇˇˇ
00584ECC  E8 50 58 00 01 00 00 00 05 00 00 00 00 00 00 00  ËPX...........
00584EDC  04 00 00 00 84 03 00 00 E8 03 00 00 00 00 00 00  ...ÅE..ÅE......
00584EEC  08 00 00 00 00 40 00 00 00 00 00 00 00 00 00 00  ....@..........
00584EFC  FF FF FF 7F E8 50 58 00 00 00 00 00 03 00 00 00  ˇˇˇËPX........
00584F0C  01 00 00 00 04 00 00 00 EB 02 00 00 E8 03 00 00  ......ÅE..ÅE..
00584F1C  00 00 00 00 08 00 00 00 00 00 00 00 00 00 00 00  ...............
00584F2C  00 00 00 00 FF FF FF 7F E8 50 58 00 01 00 00 00  ....ˇˇˇËPX....
00584F3C  03 00 00 00 02 00 00 00 04 00 00 00 60 03 00 00  .........`..
00584F4C  E8 03 00 00 00 00 00 00 08 00 00 00 00 00 00 00  ÅE.............
00584F5C  00 00 00 00 00 00 00 00 FF FF FF 7F E8 50 58 00  ........ˇˇˇËPX.
00584F6C  FF FF FF FF FF FF FF FF 03 00 00 00 04 00 00 00  ˇˇˇˇˇˇˇˇ......
00584F7C  00 00 00 00 E8 03 00 00 00 00 00 00 08 00 00 00  ....ÅE.........
00584F8C  00 00 00 00 00 00 00 00 00 00 00 00 FF FF FF 7F  ............ˇˇˇ
00584F9C  E8 50 58 00 01 00 00 00 04 00 00 00 04 00 00 00  ËPX..........
00584FAC  04 00 00 00 84 03 00 00 E8 03 00 00 00 00 00 00  ...ÅE..ÅE......
00584FBC  08 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00  ..............
00584FCC  02 00 00 00 1A 51 58 00 01 00 00 00 01 00 00 00  ...QX.......
00584FDC  00 00 00 00 04 00 00 00 81 01 00 00 E8 03 00 00  .......ÅE..ÅE..
00584FEC  00 00 00 00 08 00 00 00 10 40 00 00 01 00 00 00  .......@.....
00584FFC  00 00 00 00 FF FF FF 7F 1A 51 58 00 FF FF FF FF  ....ˇˇˇQX.ˇˇˇˇ
0058500C  FF FF FF FF 01 00 00 00 04 00 00 00 00 00 00 00  ˇˇˇˇ..........
0058501C  E8 03 00 00 00 00 00 00 08 00 00 00 00 00 00 00  ÅE.............
0058502C  01 00 00 00 00 00 00 00 02 00 00 00 1A 51 58 00  ..........QX.
0058503C  02 00 00 00 02 00 00 00 02 00 00 00 04 00 00 00  ............
0058504C  26 01 00 00 E8 03 00 00 00 00 00 00 08 00 00 00  &..ÅE.........
0058505C  00 00 00 00 01 00 00 00 00 00 00 00 02 00 00 00  ..............
0058506C  1A 51 58 00 01 00 00 00 02 00 00 00 03 00 00 00  QX..........
0058507C  04 00 00 00 51 01 00 00 E8 03 00 00 00 00 00 00  ...Q..ÅE......
0058508C  08 00 00 00 10 00 00 00 01 00 00 00 00 00 00 00  .............
0058509C  02 00 00 00 1A 51 58 00 02 00 00 00 01 00 00 00  ...QX.......
005850AC  04 00 00 00 04 00 00 00 90 02 00 00 E8 03 00 00  ......ÅE..ÅE..
005850BC  00 00 00 00 08 00 00 00 00 00 00 00 18 00 00 00  ..............

ñÏêÌéûÇÃéÁîıë§ÇÃëÊ1ïîë‡èÓïÒ
00584EBC              00 00 00 00 00 00 00 00 FF FF FF 7F      ........ˇˇˇ
00584ECC  E8 50 58 00 01 00 00 00 05 00 00 00 00 00 00 00  ËPX...........
00584EDC  04 00 00 00 84 03 00 00 E8 03 00 00 00 00 00 00  ...ÅE..ÅE......
00584EEC  08 00 00 00 00 40 00 00                          ....@..

ñÏêÌéûÇÃéÁîıë§ÇÃëÊ2ïîë‡èÓïÒ
00584EEC                          00 00 00 00 00 00 00 00          ........
00584EFC  FF FF FF 7F E8 50 58 00 00 00 00 00 03 00 00 00  ˇˇˇËPX........
00584F0C  01 00 00 00 04 00 00 00 84 03 00 00 E8 03 00 00  ......ÅE..ÅE..
00584F1C  00 00 00 00 08 00 00 00 00 00 00 00              ...........

ñÏêÌéûÇÃéÁîıë§ÇÃëÊ3ïîë‡èÓïÒ
00584F1C                                      00 00 00 00              ....
00584F2C  00 00 00 00 FF FF FF 7F E8 50 58 00 01 00 00 00  ....ˇˇˇËPX....
00584F3C  03 00 00 00 02 00 00 00 04 00 00 00 84 03 00 00  .........ÅE..
00584F4C  E8 03 00 00 00 00 00 00 08 00 00 00 00 00 00 00  ÅE.............

ñÏêÌéûÇÃéÁîıë§ÇÃëÊ4ïîë‡èÓïÒ
00584F5C  00 00 00 00 00 00 00 00 FF FF FF 7F E8 50 58 00  ........ˇˇˇËPX.
00584F6C  02 00 00 00 03 00 00 00 03 00 00 00 04 00 00 00  ............
00584F7C  32 03 00 00 E8 03 00 00 00 00 00 00 08 00 00 00  2..ÅE.........
00584F8C  00 08 00 00 00                                   ....

ñÏêÌéûÇÃéÁîıë§ÇÃëÊ5ïîë‡èÓïÒ
00584F8C              00 00 00 00 00 00 00 00 FF FF FF 7F      ........ˇˇˇ
00584F9C  E8 50 58 00 01 00 00 00 04 00 00 00 04 00 00 00  ËPX..........
00584FAC  04 00 00 00 84 01 00 00 E8 03 00 00 00 00 00 00  ...ÅE..ÅE......
00584FBC  08 00 00 00 00 00 00 00                          .......


ñÏêÌéûÇÃçUåÇë§ÇÃëÊ1ïîë‡èÓïÒ
00584FBC                          01 00 00 00 00 00 00 00          .......
00584FCC  FF FF FF 7F 1A 51 58 00 01 00 00 00 01 00 00 00  ˇˇˇQX.......
00584FDC  00 00 00 00 04 00 00 00 8F 01 00 00 E8 03 00 00  .......ÅE..ÅE..
00584FEC  00 00 00 00 08 00 00 00 00 40 00 00              ........@..


ñÏêÌéûÇÃçUåÇë§ÇÃëÊ2ïîë‡ÇÃï∫êî
00584FEC                                      01 00 00 00              ...
00584FFC  00 00 00 00 FF FF FF 7F 1A 51 58 00 00 00 00 00  ....ˇˇˇQX.....
0058500C  02 00 00 00 01 00 00 00 04 00 00 00 8E 01 00 00  .........ÅE..
0058501C  E8 03 00 00 00 00 00 00 08 00 00 00 00 00 00 00  ÅE.............


ñÏêÌéûÇÃçUåÇë§ÇÃëÊ3ïîë‡ï∫êî
0058502C  01 00 00 00 00 00 00 00 FF FF FF 7F 1A 51 58 00  .......ˇˇˇQX.
0058503C  02 00 00 00 02 00 00 00 02 00 00 00 04 00 00 00  ............
0058504C  8D 01 00 00 E8 03 00 00 00 00 00 00 08 00 00 00  ÅE..ÅE.........
0058505C  00 00 00 00                                      ....


ñÏêÌéûÇÃçUåÇë§ÇÃëÊ4ïîë‡ï∫êî
0058505C              01 00 00 00 00 00 00 00 FF FF FF 7F      .......ˇˇˇ
0058506C  1A 51 58 00 00 00 00 00 01 00 00 00 03 00 00 00  QX...........
0058507C  04 00 00 00 8C 01 00 00 E8 03 00 00 00 00 00 00  ...ÅE..ÅE......
0058508C  08 00 00 00 [00] 00 00 00                          .......

ñÏêÌéûÇÃçUåÇë§ÇÃëÊ5ïîë‡ï∫êî
0058508C                          01 00 00 00 00 00 00 00          .......
0058509C  FF FF FF 7F 1A 51 58 00 02 00 00 00 01 00 00 00  ˇˇˇQX.......
005850AC  04 00 00 00 04 00 00 00 [8B 02] 00 00 E8 03 00 00  ......ÅE..ÅE..
005850BC  00 00 00 00 08 00 00 00 [00] 00 00 00                          .......




*/


#include <windows.h>
#include <string>
#include "data_game_struct.h"
#include "data_bushou_struct.h"
#include "output_debug_stream.h"
#include "data_kahou_struct.h"
#include "data_kanni_struct.h"
#include "data_yakusyoku_struct.h"
#include "data_castle_struct.h"
#include "data_turn_struct.h"
#include "game_screen.h"
#include "game_process.h"
#include "on_serihu_message.h"
#include "bushou_albedo.h"
#include "game_screen.h"
#include "message_albedo.h"


using namespace std;

#pragma unmanaged



static int testECX = 0; // ÅöÇ±ÇÃECXÇÕÇPÅ`ÇTïîë‡èÓïÒÇ÷ÇÃÉ|ÉCÉìÉ^ÇéwÇµÇƒÇ¢ÇÈÇ™ÅAÇ≥ÇÁÇ…ç◊Ç©Ç≠ÇƒÅA
static int testEAX = 0;
static int testESP = 0;
static int testEDX = 0;
static int testEBP = 0;

void OnSSRExeGetYasenHeisuu1Execute() {
	OutputDebugStream("ÅöÅöÅöÅöOnSSRExeGetYasenHeisuu1ExecuteÇ™óàÇΩÇÊ!!!Åö\n");
	OutputDebugStream("testECX:%xÅö\n", testECX);
	OutputDebugStream("testEAX:%xÅö\n", testEAX);
	OutputDebugStream("testESP:%xÅö\n", testESP);
	OutputDebugStream("testEDX:%xÅö\n", testEDX);
	OutputDebugStream("testEBP:%xÅö\n", testEBP);
}



/*
00477E76  |. 890D 8CC86000  |MOV DWORD PTR DS:[60C88C],ECX
00477E7C  |. 8B4C24 10      |MOV ECX,DWORD PTR SS:[ESP+10]
00477E80  |. A3 E0ED5300    |MOV DWORD PTR DS:[53EDE0],EAX
00477E85  |. A3 88C86000    |MOV DWORD PTR DS:[60C888],EAX
00477E8A  |. E8 A12F0000    |CALL Nobunaga.0047AE30
00477E8F  |. 50             |PUSH EAX
*/


int pSSRExeJumpFromToOnSSRExeGetYasenHeisuu1 = 0x477E8A; // ä÷êîÇÕÇ±ÇÃÉAÉhÉåÉXÇ©ÇÁÅAOnSSRExeGetYasenHeisuu1Ç÷Ç∆ÉWÉÉÉìÉvÇµÇƒÇ≠ÇÈÅB
int pSSRExeJumpCallFromToOnSSRExeGetYasenHeisuu1 = 0x47AE30; // å≥ÅXÇ†Ç¡ÇΩèàóùÇÃCallêÊ
int pSSRExeReturnLblFromOnSSRExeGetYasenHeisuu1 = 0x477E8F; // ä÷êîÇ™ç≈å„Ç‹Ç≈Ç¢Ç≠Ç∆ÅAÇ±ÇÃTENSHOU.EXEì‡Ç…íºê⁄ÉWÉÉÉìÉvÇ∑ÇÈ

#pragma warning(disable:4733)

__declspec(naked) void WINAPI OnSSRExeGetYasenHeisuu1() {
	// ÉXÉ^ÉbÉNÇ…ÇΩÇﬂÇƒÇ®Ç≠
	__asm {
		mov testECX, ecx
		mov testEAX, eax
		mov testESP, esp
		mov testEDX, edx
		mov testEBP, ebp

		push eax
		push ebx
		push ecx
		push edx
		push esp
		push ebp
		push esi
		push edi
	}

	OnSSRExeGetYasenHeisuu1Execute();

	// ÉXÉ^ÉbÉNÇ…à¯Ç´èoÇ∑
	__asm {
		pop edi
		pop esi
		pop ebp
		pop esp
		pop edx
		pop ecx
		pop ebx
		pop eax

		call pSSRExeJumpCallFromToOnSSRExeGetYasenHeisuu1 // å≥ÇÃèàóù

		jmp pSSRExeReturnLblFromOnSSRExeGetYasenHeisuu1
	}
}
#pragma warning(default: 4733) // ÉèÅ[ÉjÉìÉOÇÃó}êßÇâèúÇ∑ÇÈ



char cmdOnSSRExeJumpFromGetYasenHeisuu1[6] = "\xE9";
// å≥ÇÃñΩóﬂÇ™5ÉoÉCÉgÅAà»å„ÇÃä÷êîÇ≈ê∂Ç‹ÇÍÇÈñΩóﬂÇ™çáåvÇTÉoÉCÉgÇ»ÇÃÇ≈Åc ç≈å„ÇPÇ¬égÇÌÇ»Ç¢


// ÉjÅ[ÉÇÉjÉbÉNèëÇ´ä∑Ç¶óp
void WriteAsmJumperOnSSRExeGetYasenHeisuu1() {

	// Ç‹Ç∏ÉAÉhÉåÉXÇêîéöÇ∆ÇµÇƒàµÇ§
	int iAddress = (int)OnSSRExeGetYasenHeisuu1;
	int SubAddress = iAddress - (pSSRExeJumpFromToOnSSRExeGetYasenHeisuu1 + 5);
	// ÇTÇ∆Ç¢Ç§ÇÃÇÕÅA0046C194  -E9 ????????  JMP TSMod.OnTSExeGetDaimyoKoukeishaBushouID  ÇÃñΩóﬂÇ…ïKóvÇ»ÉoÉCÉgêîÅBóvÇ∑ÇÈÇ…ÇTÉoÉCÉgë´Ç∑Ç∆éüÇÃÉjÅ[ÉÇÉjÉbÉNñΩóﬂåQÇ…à⁄ìÆÇ∑ÇÈÇÃÇæÅBÇªÇµÇƒÇªÇ±Ç©ÇÁÇÃç∑ï™Ç™ÉWÉÉÉìÉvÇ∑ÇÈç€ÇÃñ⁄ìIäiÇ∆ÇµÇƒóòópÇ≥ÇÍÇÈÅB
	memcpy(cmdOnSSRExeJumpFromGetYasenHeisuu1 + 1, &SubAddress, 4); // +1 ÇÕE9ÇÃéüÇ©ÇÁ4ÉoÉCÉgï™èëÇ´ä∑Ç¶ÇÈÇ©ÇÁÅB

	// ç\ízÇµÇΩÉjÅ[ÉÇÉjÉbÉNñΩóﬂÇTENSHOU.EXEÇÃÉÅÉÇÉäÇ…èëÇ´ä∑Ç¶ÇÈ
	WriteProcessMemory(hCurrentProcess, (LPVOID)(pSSRExeJumpFromToOnSSRExeGetYasenHeisuu1), cmdOnSSRExeJumpFromGetYasenHeisuu1, 5, NULL); //5ÉoÉCÉgÇÃÇ›èëÇ´çûÇﬁ
}

#pragma managed
